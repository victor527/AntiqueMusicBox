/*
 * File:   VFDdisplayMessage.c
 * Author: ECE477 Team8 Antique Music Box
 * This file display the message on VFD for the Antique Music Box
 * Created on October 31, 2015, 12:00 AM
 */

#include <xc.h>
#include "p33Fxxxx.h"
#include "configuration_pins.h"
#include "VFDdisplayMessage.h"

void shiftout(int);
void delay(int);

void VFDdisplayMessage(char* message)
{
    VFD_BLANK = 0;    // set blank as low
    int i;
    for(i=0;i<10;i++)
        shiftout(0);
    while(*message != '\0' && *message != '.')
    {
        shiftout((*message++) - 0x20);
        VFD_LATCH = 1;
        VFD_LATCH = 0;
    }
}

void delay(int n)
{
    int i;
    int index;
    for(i=0;i<20000;i++)
    {
        for(index=0;index<n;index++);
    }
}

void shiftout(int data)
{
    long ascii[97][20]={
        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0}, //blank    
        {0,0,0,0,0,0,0,1,1,1,0,0,1,0,0,0,0,0,0,0}, //!
        {0,0,0,1,0,0,0,0,0,1,0,0,1,1,0,0,0,0,0,0}, // ?2?
        {0,1,0,0,1,0,0,0,0,0,0,1,0,1,0,1,0,1,0,0},// ?3?
        {0,0,1,0,1,0,1,1,0,0,1,1,0,1,0,1,1,1,0,0},// $
        {0,0,0,1,1,0,1,1,0,0,1,0,1,1,0,1,1,1,0,0},// %
        {0,1,1,0,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0},  // ?6?
        {0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0},// ?7?
        {0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0},//  ?8?
        {0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0},//  ?9?
        {0,0,0,1,1,1,0,0,0,0,0,1,1,1,1,1,0,0,0,0},// *
        {0,0,0,0,1,0,0,0,0,0,0,1,0,1,0,1,0,0,0,0},// +
        {0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0},  // ?c?
        {0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0},// -
        {0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0},  //  ?e?
        {0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0},//  /
               
        {0,1,1,1,0,0,1,1,0,1,1,0,1,0,0,0,1,1,0,0}, //0
        {0,0,0,0,0,0,0,1,0,1,0,0,1,0,0,0,0,0,0,0}, //1
        {0,1,1,0,0,0,1,0,0,1,1,1,0,0,0,1,1,0,0,0}, //2
        {0,0,1,0,0,0,1,1,0,1,1,1,0,0,0,0,1,0,0,0}, //3
        {0,0,0,0,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,0}, //4
        {0,0,1,0,0,0,1,1,0,0,1,1,0,0,0,1,1,1,0,0}, //5
        {0,1,1,0,0,0,1,1,0,0,0,1,0,0,0,1,1,1,0,0}, //6
        {0,0,0,0,0,0,0,1,0,1,1,0,0,0,0,0,1,0,0,0}, //7
        {0,1,1,0,0,0,1,1,0,1,1,1,0,0,0,1,1,1,0,0}, //8
        {0,0,0,0,0,0,1,1,0,1,1,1,0,0,0,1,1,1,0,0}, //9
        {0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0}, // 2a
        {0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0}, // 2b
        {0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,1,0,0,0,0}, //  2c
        {0,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,1,0,0,0}, // 2d
        {0,0,0,1,0,0,0,0,0,0,0,1,0,0,1,0,0,0,0,0}, // 2e
        {0,0,0,0,1,0,0,0,1,1,1,1,0,0,0,0,1,0,0,0}, // 2f
       
        {0,1,1,0,0,0,1,0,0,0,1,1,1,0,0,0,1,1,0,0}, // 30
        {0,1,0,0,0,0,0,1,0,1,1,1,0,0,0,1,1,1,0,0}, //A
        {0,0,1,0,1,0,1,1,0,1,1,1,0,1,0,0,1,0,0,0}, //B
        {0,1,1,0,0,0,1,0,0,0,1,0,0,0,0,0,1,1,0,0},
        {0,0,1,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,0,0},
        {0,1,1,0,0,0,1,0,0,0,1,0,0,0,0,1,1,1,0,0},
        {0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,1,1,1,0,0},
        {0,1,1,0,0,0,1,1,0,0,1,1,0,0,0,0,1,1,0,0},
        {0,1,0,0,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,0},
        {0,0,1,0,1,0,1,0,0,0,1,0,0,1,0,0,1,0,0,0},
        {0,1,1,0,0,0,1,1,0,1,0,0,0,0,0,0,0,0,0,0},
        {0,1,0,0,0,1,0,0,0,0,0,0,1,0,0,1,0,1,0,0},
        {0,1,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0},
        {0,1,0,0,0,0,0,1,0,1,0,0,1,0,1,0,0,1,0,0},
        {0,1,0,0,0,1,0,1,0,1,0,0,0,0,1,0,0,1,0,0},
        {0,1,1,0,0,0,1,1,0,1,1,0,0,0,0,0,1,1,0,0},
       
        {0,1,0,0,0,0,0,0,0,1,1,1,0,0,0,1,1,1,0,0},
        {0,1,1,0,0,1,1,1,0,1,1,0,0,0,0,0,1,1,0,0},
        {0,1,0,0,0,1,0,0,0,1,1,1,0,0,0,1,1,1,0,0},
        {0,0,1,0,0,0,1,1,0,0,1,1,0,0,0,1,1,1,0,0},
        {0,0,0,0,1,0,0,0,0,0,1,0,0,1,0,0,1,0,0,0},
        {0,1,1,0,0,0,1,1,0,1,0,0,0,0,0,0,0,1,0,0},
        {0,1,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0},
        {0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,1,0,0},
        {0,0,0,1,0,1,0,0,0,0,0,0,1,0,1,0,0,0,0,0},
        {0,0,0,0,1,0,0,0,0,1,0,1,0,0,0,1,0,1,0,0},
        {0,0,1,1,0,0,1,0,0,0,1,0,1,0,0,0,1,0,0,0},
        {0,0,0,0,1,0,1,0,0,0,1,0,0,1,0,0,0,0,0,0},// [
        {0,0,0,0,0,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0},// ?4c ?   
        {0,0,0,0,0,0,1,1,0,1,1,0,0,0,0,0,0,0,0,0},// ]
        {0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0}, //4e
        {0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0}, //4f

        {0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0}, // 5 0   
        {0,1,1,0,1,1,0,0,0,0,0,0,0,0,0,1,0,0,0,0}, //a
        {0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0}, //b
        {0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0}, //c
        {0,1,1,0,1,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0},
        {0,1,1,1,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0},
        {0,0,0,0,1,0,0,0,0,0,1,1,0,1,0,1,0,0,0,0},
        {0,0,1,0,1,0,0,0,0,0,0,0,0,1,0,1,1,1,0,0},
        {0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0},
        {0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,1,1,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0},
        {0,0,0,0,1,1,0,0,0,0,0,0,1,1,0,0,0,0,0,0},
        {0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0},
        {0,1,0,0,1,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0},
        {0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0},
        {0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0},
       
        {0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,0,0},
        {0,0,0,0,1,0,0,0,0,0,0,0,0,1,0,1,1,1,0,0},
        {0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0},
        {0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,1,1,1,0,0},
        {0,0,0,0,1,0,0,0,0,0,0,1,0,1,0,1,0,0,0,0},
        {0,1,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,1,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,0,0,0},
        {0,0,0,1,0,1,0,0,0,0,0,0,1,0,1,0,0,0,0,0},
        {0,0,0,0,1,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0},
        {0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0},
        {0,0,0,0,1,0,1,0,0,0,1,0,0,1,0,1,0,0,0,0},// {
        {0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0},// ?6c?
        {0,0,0,0,0,0,1,1,0,1,1,1,0,0,0,0,0,0,0,0},// }
        {0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0},// 6e
        {0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0}, //6f
       
        {1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1}//debug

    };

    int i;
    int var = 0;

    for (i=19; i>=0; i--)  {
        var = ascii[data][i];
        VFD_DATA = var;
        VFD_CLOCK = 0;
        VFD_CLOCK = 1;
        VFD_DATA = 0;
    }
}